{% extends 'layouts/base.html' %}

{% block content %}
<div class="vstack gap-2 col-md-5 mx-auto">
  <h1 class="mb-4">Hello, {{ name }}!</h1>
  <h2>Songs's list</h2>
  <ul class="list-group">
    {% for music in musics %}
      <li class="list-group-item">
        <table class="table">
          <thead>
            <tr>
              <th scope="col">Artist</th>
              <th scope="col">Song (click to play)</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>{{ music.artist }}</td>
              <td>
                <a href="#" onclick="playAudio('{{ music.path }}'); return false;">
                  {{ music.music_name }}
                </a>
              </td>
            </tr>
          </tbody>
        </table>
      </li>
    {% empty %}
      <li class="list-group-item">no mp3 found</li>
    {% endfor %}
  </ul>

  <!-- Lecteur audio caché, contrôlé par javascript -->
  <audio id="audioPlayer" controls style="width: 100%; margin-top: 20px; display: none;">
    <source id="audioSource" src="" type="audio/mpeg">
    Your browser does not support the audio element.
  </audio>
</div>

<script>
  function playAudio(filePath) {
    const audioPlayer = document.getElementById('audioPlayer');
    const audioSource = document.getElementById('audioSource');
    audioSource.src = '/media/' + filePath;
    audioPlayer.load();
    audioPlayer.style.display = 'block';
    audioPlayer.play();
  }
</script>
{% endblock %}
